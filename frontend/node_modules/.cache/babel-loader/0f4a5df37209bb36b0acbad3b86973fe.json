{"ast":null,"code":"import React,{Fragment,useEffect,useRef}from\"react\";import CheckoutSteps from\"../Cart/CheckoutSteps\";import{useSelector,useDispatch}from\"react-redux\";import MetaData from\"../layout/MetaData\";import{Typography}from\"@material-ui/core\";import{useAlert}from\"react-alert\";import{CardNumberElement,CardCvcElement,CardExpiryElement,useStripe,useElements}from\"@stripe/react-stripe-js\";import axios from\"axios\";import\"./payment.css\";import CreditCardIcon from\"@material-ui/icons/CreditCard\";import EventIcon from\"@material-ui/icons/Event\";import VpnKeyIcon from\"@material-ui/icons/VpnKey\";import{createOrder,clearErrors}from\"../../actions/orderAction\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const Payment=_ref=>{let{history}=_ref;const orderInfo=JSON.parse(sessionStorage.getItem(\"orderInfo\"));const dispatch=useDispatch();const alert=useAlert();const stripe=useStripe();const elements=useElements();const payBtn=useRef(null);const{shippingInfo,cartItems}=useSelector(state=>state.cart);const{user}=useSelector(state=>state.user);const{error}=useSelector(state=>state.newOrder);const paymentData={amount:Math.round(orderInfo.totalPrice*100)};const order={shippingInfo,orderItems:cartItems,itemsPrice:orderInfo.subtotal,taxPrice:orderInfo.tax,shippingPrice:orderInfo.shippingCharges,totalPrice:orderInfo.totalPrice};const submitHandler=async e=>{e.preventDefault();payBtn.current.disabled=true;try{const config={headers:{\"Content-Type\":\"application/json\",\"Authorization\":\"Bearer \".concat(process.env.STRIPE_API_KEY)}};const{data}=await axios.post(\"/api/v1/payment/process\",paymentData,config);const client_secret=data.client_secret;if(!stripe||!elements)return;const result=await stripe.confirmCardPayment(client_secret,{payment_method:{card:elements.getElement(CardNumberElement),billing_details:{name:user.name,email:user.email,address:{line1:shippingInfo.address,city:shippingInfo.city,state:shippingInfo.state,postal_code:shippingInfo.pinCode,country:shippingInfo.country}}}});if(result.error){payBtn.current.disabled=false;alert.error(result.error.message);}else{if(result.paymentIntent.status===\"succeeded\"){order.paymentInfo={id:result.paymentIntent.id,status:result.paymentIntent.status};dispatch(createOrder(order));history.push(\"/success\");}else{alert.error(\"There's some issue while processing payment \");}}}catch(error){payBtn.current.disabled=false;alert.error(error.response.data.message);}};useEffect(()=>{if(error){alert.error(error);dispatch(clearErrors());}},[dispatch,error,alert]);return/*#__PURE__*/_jsxs(Fragment,{children:[/*#__PURE__*/_jsx(MetaData,{title:\"Payment\"}),/*#__PURE__*/_jsx(CheckoutSteps,{activeStep:2}),/*#__PURE__*/_jsx(\"div\",{className:\"paymentContainer\",children:/*#__PURE__*/_jsxs(\"form\",{className:\"paymentForm\",onSubmit:e=>submitHandler(e),children:[/*#__PURE__*/_jsx(Typography,{children:\"Card Info\"}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(CreditCardIcon,{}),/*#__PURE__*/_jsx(CardNumberElement,{className:\"paymentInput\"})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(EventIcon,{}),/*#__PURE__*/_jsx(CardExpiryElement,{className:\"paymentInput\"})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(VpnKeyIcon,{}),/*#__PURE__*/_jsx(CardCvcElement,{className:\"paymentInput\"})]}),/*#__PURE__*/_jsx(\"input\",{type:\"submit\",value:\"Pay - \\u20B9\".concat(orderInfo&&orderInfo.totalPrice),ref:payBtn,className:\"paymentFormBtn\"})]})})]});};export default Payment;","map":{"version":3,"names":["React","Fragment","useEffect","useRef","CheckoutSteps","useSelector","useDispatch","MetaData","Typography","useAlert","CardNumberElement","CardCvcElement","CardExpiryElement","useStripe","useElements","axios","CreditCardIcon","EventIcon","VpnKeyIcon","createOrder","clearErrors","jsx","_jsx","jsxs","_jsxs","Payment","_ref","history","orderInfo","JSON","parse","sessionStorage","getItem","dispatch","alert","stripe","elements","payBtn","shippingInfo","cartItems","state","cart","user","error","newOrder","paymentData","amount","Math","round","totalPrice","order","orderItems","itemsPrice","subtotal","taxPrice","tax","shippingPrice","shippingCharges","submitHandler","e","preventDefault","current","disabled","config","headers","concat","process","env","STRIPE_API_KEY","data","post","client_secret","result","confirmCardPayment","payment_method","card","getElement","billing_details","name","email","address","line1","city","postal_code","pinCode","country","message","paymentIntent","status","paymentInfo","id","push","response","children","title","activeStep","className","onSubmit","type","value","ref"],"sources":["C:/Users/SANKET TAVETHIYA/Desktop/MERN PRO/frontend/src/component/Cart/Payment.js"],"sourcesContent":["\nimport React, { Fragment, useEffect, useRef } from \"react\";\nimport CheckoutSteps from \"../Cart/CheckoutSteps\";\nimport { useSelector, useDispatch } from \"react-redux\";\nimport MetaData from \"../layout/MetaData\";\nimport { Typography } from \"@material-ui/core\";\nimport { useAlert } from \"react-alert\";\nimport {\n  CardNumberElement,\n  CardCvcElement,\n  CardExpiryElement,\n  useStripe,\n  useElements,\n} from \"@stripe/react-stripe-js\";\n\nimport axios from \"axios\";\nimport \"./payment.css\";\nimport CreditCardIcon from \"@material-ui/icons/CreditCard\";\nimport EventIcon from \"@material-ui/icons/Event\";\nimport VpnKeyIcon from \"@material-ui/icons/VpnKey\";\nimport { createOrder, clearErrors } from \"../../actions/orderAction\";\n\nconst Payment = ({ history }) => {\n  const orderInfo = JSON.parse(sessionStorage.getItem(\"orderInfo\"));\n\n  const dispatch = useDispatch();\n  const alert = useAlert();\n  const stripe = useStripe();\n  const elements = useElements();\n  const payBtn = useRef(null);\n\n  const { shippingInfo, cartItems } = useSelector((state) => state.cart);\n  const { user } = useSelector((state) => state.user);\n  const { error } = useSelector((state) => state.newOrder);\n  const paymentData = {\n    amount: Math.round(orderInfo.totalPrice * 100),\n  };\n  \n  const order = {\n    shippingInfo,\n    orderItems: cartItems,\n    itemsPrice: orderInfo.subtotal,\n    taxPrice: orderInfo.tax,\n    shippingPrice: orderInfo.shippingCharges,\n    totalPrice: orderInfo.totalPrice,\n  }; \n\n  const submitHandler = async (e) => {\n    e.preventDefault();\n\n    payBtn.current.disabled = true;\n\n    try {\n      const config = {\n        headers: {\n          \"Content-Type\": \"application/json\",\n          \"Authorization\": `Bearer ${process.env.STRIPE_API_KEY}`,\n        },\n      };\n      const { data } = await axios.post(\n        \"/api/v1/payment/process\",\n        paymentData,\n        config\n      );\n\n      const client_secret = data.client_secret;\n\n      if (!stripe || !elements) return;\n\n      const result = await stripe.confirmCardPayment(client_secret, {\n        payment_method: {\n          card: elements.getElement(CardNumberElement),\n          billing_details: {\n            name: user.name,\n            email: user.email,\n            address: {\n              line1: shippingInfo.address,\n              city: shippingInfo.city,\n              state: shippingInfo.state,\n              postal_code: shippingInfo.pinCode,\n              country: shippingInfo.country,\n            },\n          },\n        },\n      });\n\n      if (result.error) {\n        payBtn.current.disabled = false;\n\n        alert.error(result.error.message);\n      } else {\n        if (result.paymentIntent.status === \"succeeded\") {\n          order.paymentInfo = {\n            id: result.paymentIntent.id,\n            status: result.paymentIntent.status,\n          };\n\n          dispatch(createOrder(order));\n\n          history.push(\"/success\");\n        } else {\n          alert.error(\"There's some issue while processing payment \");\n        }\n      }\n    } catch (error) {\n      payBtn.current.disabled = false;\n      alert.error(error.response.data.message);\n    }\n  };\n\n  useEffect(() => {\n    if (error) {\n      alert.error(error);\n      dispatch(clearErrors());\n    }\n  }, [dispatch, error, alert]);\n  return (\n    <Fragment>\n      <MetaData title=\"Payment\" />\n      <CheckoutSteps activeStep={2} />\n      <div className=\"paymentContainer\">\n        <form className=\"paymentForm\" onSubmit={(e) => submitHandler(e)}>\n          <Typography>Card Info</Typography>\n          <div>\n            <CreditCardIcon />\n            <CardNumberElement className=\"paymentInput\" />\n          </div>\n          <div>\n            <EventIcon />\n            <CardExpiryElement className=\"paymentInput\" />\n          </div>\n          <div>\n            <VpnKeyIcon />\n            <CardCvcElement className=\"paymentInput\" />\n          </div>\n\n          <input\n            type=\"submit\"\n            value={`Pay - â‚¹${orderInfo && orderInfo.totalPrice}`}\n            ref={payBtn}\n            className=\"paymentFormBtn\"\n          />\n        </form>\n      </div>\n    </Fragment>\n  );\n};\n\nexport default Payment;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}